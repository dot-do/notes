# NPM and PyPI Package Registry APIs - Research Report

**Date:** 2025-10-03
**Purpose:** Comprehensive documentation of NPM and PyPI registry APIs, data structures, and best practices for package metadata ingestion

---

## Table of Contents

1. [NPM Registry](#npm-registry)
   - [API Endpoints](#npm-api-endpoints)
   - [Data Structures](#npm-data-structures)
   - [Rate Limits & Authentication](#npm-rate-limits--authentication)
   - [Bulk Download Approaches](#npm-bulk-download-approaches)
   - [Download Statistics API](#npm-download-statistics-api)
2. [PyPI Registry](#pypi-registry)
   - [API Endpoints](#pypi-api-endpoints)
   - [Data Structures](#pypi-data-structures)
   - [Rate Limits & Authentication](#pypi-rate-limits--authentication)
   - [Bulk Download Approaches](#pypi-bulk-download-approaches)
3. [Security & Vulnerability Data](#security--vulnerability-data)
4. [Best Practices](#best-practices)
5. [Example API Responses](#example-api-responses)

---

## NPM Registry

### NPM API Endpoints

#### Official Documentation
- **Main API Docs:** https://api-docs.npmjs.com/
- **Registry GitHub Repo:** https://github.com/npm/registry
- **Registry API Spec:** https://github.com/npm/registry/blob/main/docs/REGISTRY-API.md

#### Core Endpoints

##### 1. Registry Metadata
```
GET https://registry.npmjs.org/
```
Returns database statistics and registry metadata.

**Response Fields:**
- `db_name`: Database name
- `doc_count`: Total number of packages
- `doc_del_count`: Deleted packages count
- `update_seq`: Current sequence number
- `purge_seq`: Purge sequence number
- `disk_size`: Database size in bytes

##### 2. Package Metadata (Packument)
```
GET https://registry.npmjs.org/{package}
```
Returns complete package document ("packument") with all versions and metadata.

**Headers:**
- `Accept: application/json` - Full metadata
- `Accept: application/vnd.npm.install-v1+json` - Minimal install metadata only

**Response Structure:**
```json
{
  "_id": "package-name",
  "_rev": "123-abc",
  "name": "package-name",
  "description": "Package description",
  "dist-tags": {
    "latest": "1.0.0",
    "next": "1.1.0-beta.1"
  },
  "versions": {
    "1.0.0": { /* version manifest */ }
  },
  "time": {
    "created": "2020-01-01T00:00:00.000Z",
    "modified": "2023-12-01T00:00:00.000Z",
    "1.0.0": "2020-01-01T00:00:00.000Z"
  },
  "maintainers": [
    {
      "name": "username",
      "email": "user@example.com"
    }
  ],
  "repository": {
    "type": "git",
    "url": "git+https://github.com/user/repo.git"
  },
  "users": {
    "username": true
  },
  "keywords": ["keyword1", "keyword2"]
}
```

##### 3. Specific Version
```
GET https://registry.npmjs.org/{package}/{version}
```
Returns manifest for a specific package version.

##### 4. Search API
```
GET https://registry.npmjs.org/-/v1/search?text={query}
```

**Query Parameters:**
- `text` - Full-text search query
- `size` - Results limit (default: 20, max: 250)
- `from` - Result offset for pagination
- `quality` - Quality score weight (0.0-1.0)
- `popularity` - Popularity score weight (0.0-1.0)
- `maintenance` - Maintenance score weight (0.0-1.0)

**Search Qualifiers:**
- `author:username` - Filter by author
- `maintainer:username` - Filter by maintainer
- `scope:foo` - Filter by scope (@foo/*)
- `keywords:term` - Filter by keywords
- `not:unstable` - Exclude unstable versions
- `is:insecure` - Show packages with vulnerabilities

**Response Structure:**
```json
{
  "objects": [
    {
      "package": {
        "name": "package-name",
        "version": "1.0.0",
        "description": "Package description",
        "keywords": ["keyword1"],
        "date": "2023-01-01T00:00:00.000Z",
        "links": {
          "npm": "https://www.npmjs.com/package/package-name",
          "homepage": "https://example.com",
          "repository": "https://github.com/user/repo",
          "bugs": "https://github.com/user/repo/issues"
        },
        "author": {
          "name": "Author Name",
          "email": "author@example.com"
        },
        "publisher": {
          "username": "username",
          "email": "user@example.com"
        },
        "maintainers": [
          {
            "username": "username",
            "email": "user@example.com"
          }
        ]
      },
      "score": {
        "final": 0.92,
        "detail": {
          "quality": 0.93,
          "popularity": 0.85,
          "maintenance": 0.99
        }
      },
      "searchScore": 100000.42
    }
  ],
  "total": 1,
  "time": "Wed Oct 03 2025 00:00:00 GMT+0000 (UTC)"
}
```

##### 5. Replication API
```
GET https://replicate.npmjs.com/registry/
GET https://replicate.npmjs.com/registry/_changes
GET https://replicate.npmjs.com/registry/-/all
```

**Important Notes:**
- Old endpoint `http://skimdb.npmjs.com` is deprecated
- New endpoint: `https://replicate.npmjs.com/registry/`
- Migration completed May 29, 2025
- During transition, use header: `npm-replication-opt-in: true`

**Replication Endpoints:**

**Get Current Sequence:**
```bash
curl -H "npm-replication-opt-in: true" "https://replicate.npmjs.com/registry/"
```

**Get Changes Feed:**
```
GET https://replicate.npmjs.com/registry/_changes?since={seq}&limit={limit}
```

**Parameters:**
- `since` - Sequence number to start from (for incremental updates)
- `limit` - Max results per request (default: 1000, max: 10000)
- `include_docs` - **REMOVED in 2025 API update** (was used for bulk metadata)

**Changes Response:**
```json
{
  "results": [
    {
      "seq": 12345,
      "id": "package-name",
      "changes": [
        {
          "rev": "123-abc"
        }
      ]
    }
  ],
  "last_seq": 12350
}
```

**Get All Packages:**
```
GET https://replicate.npmjs.com/registry/-/all
POST https://replicate.npmjs.com/registry/_all_docs
```

**Known Limitations (2025):**
- `include_docs` parameter removed - must fetch each package individually
- Streaming responses removed (`feed=longpoll`, `feed=continuous`, `feed=eventsource`)
- Manual pagination required using sequence IDs

### NPM Data Structures

#### Packument Fields

**Always Present:**
- `_id` - Package name (CouchDB document ID)
- `_rev` - Document revision number
- `name` - Package name
- `dist-tags` - Object mapping tags to versions
- `versions` - Object mapping version strings to manifests

**Common Fields:**
- `description` - Human-readable description
- `keywords` - Array of search keywords
- `maintainers` - Array of maintainer objects
- `time` - Object with creation/modification timestamps
- `author` - Author object or string
- `repository` - Repository object with type and URL
- `bugs` - Bug tracker URL or object
- `homepage` - Homepage URL
- `license` - SPDX license identifier or object
- `users` - Object mapping usernames to `true` (stars)
- `readme` - README content (full metadata only)
- `readmeFilename` - README filename

#### Version Manifest Fields

Each version in `versions["{version}"]` contains:

**Required:**
- `name` - Package name
- `version` - Specific version string
- `dist` - Distribution object:
  - `tarball` - Download URL
  - `shasum` - SHA-1 checksum
  - `integrity` - Subresource Integrity string
  - `fileCount` - Number of files in tarball
  - `unpackedSize` - Size in bytes when extracted

**Dependencies:**
- `dependencies` - Production dependencies
- `devDependencies` - Development dependencies
- `peerDependencies` - Peer dependencies
- `optionalDependencies` - Optional dependencies
- `bundledDependencies` - Bundled dependencies

**Platform Requirements:**
- `engines` - Node/npm version requirements
- `os` - Supported operating systems array
- `cpu` - Supported CPU architectures array

**Metadata:**
- `description` - Package description
- `keywords` - Search keywords array
- `license` - License identifier
- `author` - Author object
- `contributors` - Contributors array
- `maintainers` - Maintainers array
- `repository` - Repository object
- `bugs` - Bug tracker object
- `homepage` - Homepage URL
- `funding` - Funding information object/array
- `scripts` - Package scripts object
- `bin` - Executable files object
- `main` - Main entry point
- `module` - ES module entry point
- `types` - TypeScript definitions path
- `exports` - Package exports map (Node.js 12+)

### NPM Rate Limits & Authentication

#### Rate Limits

**Official Limits (as of 2025):**
- **Bulk queries:** 128 packages at a time
- **Download stats:** Maximum 365 days of data per request
- **Other queries:** Maximum 18 months of data
- **Replication API:** Max 10,000 results per `_changes` request

**Important Notes:**
- NPM reserves right to limit API usage without warning for abuse patterns
- No comprehensive public documentation of all rate limits
- Download statistics earliest date: January 10, 2015
- Limited official rate limit documentation (known issue)

#### Authentication

**Not Required For:**
- Public package metadata
- Search API
- Download statistics
- Replication API (public data)

**Required For:**
- Publishing packages
- Package management operations
- Private package access

**Methods:**
- npm authentication token in headers
- `.npmrc` configuration file
- Environment variable: `NPM_TOKEN`

### NPM Bulk Download Approaches

#### 1. Replication API (Recommended for Mirroring)

**Strategy:**
```bash
# 1. Get current sequence number
curl https://replicate.npmjs.com/registry/ | jq '.update_seq'

# 2. Fetch changes incrementally
curl "https://replicate.npmjs.com/registry/_changes?since=0&limit=10000" > changes.json

# 3. Extract package names and fetch metadata individually
cat changes.json | jq -r '.results[].id' | while read pkg; do
  curl "https://registry.npmjs.org/$pkg" > "packages/$pkg.json"
done

# 4. Store last_seq for next run
cat changes.json | jq -r '.last_seq' > last_seq.txt
```

**Performance:**
- ~3.5 million packages as of May 2025
- Batches of 10,000 packages take ~5 seconds with good internet
- Full download: ~377MB, ~30 minutes total
- Incremental updates use `since` parameter with last sequence number

#### 2. Direct Package Fetching

**Approach:**
- Fetch package list from `/_all_docs` or `/_changes`
- Request each package individually: `GET /{package}`
- Use `Accept: application/vnd.npm.install-v1+json` for minimal metadata
- Parallel requests with rate limiting

**Best Practices:**
- Implement exponential backoff for retries
- Respect rate limits (monitor 429 responses)
- Use CDN-friendly caching headers
- Store ETags for conditional requests

#### 3. Third-Party Mirrors

**Options:**
- Verdaccio - Private npm proxy registry
- Nexus Repository - Enterprise artifact manager
- Artifactory - Universal package manager

### NPM Download Statistics API

#### Base URL
```
https://api.npmjs.org/downloads
```

#### Endpoints

##### 1. Point Queries (Total Downloads)
```
GET /downloads/point/{period}/{package}
GET /downloads/point/{start-date}:{end-date}/{package}
```

**Periods:**
- `last-day` - Previous 24 hours
- `last-week` - Previous 7 days
- `last-month` - Previous 30 days
- `last-year` - Previous 365 days

**Date Range:**
- Format: `YYYY-MM-DD:YYYY-MM-DD`
- Maximum: 365 days

**Example:**
```bash
curl https://api.npmjs.org/downloads/point/last-week/react
```

**Response:**
```json
{
  "downloads": 10889040,
  "start": "2025-09-26",
  "end": "2025-10-02",
  "package": "react"
}
```

##### 2. Range Queries (Daily Breakdown)
```
GET /downloads/range/{period}/{package}
GET /downloads/range/{start-date}:{end-date}/{package}
```

**Response:**
```json
{
  "downloads": [
    {
      "downloads": 1234567,
      "day": "2025-09-26"
    },
    {
      "downloads": 1345678,
      "day": "2025-09-27"
    }
  ],
  "start": "2025-09-26",
  "end": "2025-10-02",
  "package": "react"
}
```

##### 3. Bulk Queries (Point Mode Only)
```
GET /downloads/point/{period}/{package1},{package2},{package3}
```

**Limits:**
- Maximum: 128 packages per request
- Only works in point mode (not range mode)

**Example:**
```bash
curl https://api.npmjs.org/downloads/point/last-month/react,vue,angular
```

**Response:**
```json
{
  "react": {
    "downloads": 43556160,
    "start": "2025-09-03",
    "end": "2025-10-02",
    "package": "react"
  },
  "vue": {
    "downloads": 12345678,
    "start": "2025-09-03",
    "end": "2025-10-02",
    "package": "vue"
  },
  "angular": {
    "downloads": 9876543,
    "start": "2025-09-03",
    "end": "2025-10-02",
    "package": "angular"
  }
}
```

---

## PyPI Registry

### PyPI API Endpoints

#### Official Documentation
- **Main Docs:** https://docs.pypi.org/
- **JSON API:** https://docs.pypi.org/api/json/
- **Index API:** https://docs.pypi.org/api/index-api/
- **Warehouse API Ref:** https://warehouse.readthedocs.io/api-reference/
- **BigQuery Datasets:** https://docs.pypi.org/api/bigquery/

#### Core Endpoints

##### 1. Project Metadata (Latest Version)
```
GET https://pypi.org/pypi/{project}/json
```

Returns complete metadata for the latest version of a project.

**Response Structure:**
```json
{
  "info": {
    "author": "Author Name",
    "author_email": "author@example.com",
    "bugtrack_url": null,
    "classifiers": [
      "Development Status :: 5 - Production/Stable",
      "Intended Audience :: Developers",
      "License :: OSI Approved :: MIT License",
      "Programming Language :: Python :: 3",
      "Programming Language :: Python :: 3.8",
      "Programming Language :: Python :: 3.9",
      "Programming Language :: Python :: 3.10",
      "Programming Language :: Python :: 3.11",
      "Programming Language :: Python :: 3.12"
    ],
    "description": "Long package description...",
    "description_content_type": "text/markdown",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "https://github.com/user/project",
    "keywords": "keyword1 keyword2",
    "license": "MIT",
    "maintainer": "Maintainer Name",
    "maintainer_email": "maintainer@example.com",
    "name": "project-name",
    "package_url": "https://pypi.org/project/project-name/",
    "platform": null,
    "project_url": "https://pypi.org/project/project-name/",
    "project_urls": {
      "Homepage": "https://github.com/user/project",
      "Bug Reports": "https://github.com/user/project/issues",
      "Source": "https://github.com/user/project"
    },
    "release_url": "https://pypi.org/project/project-name/1.0.0/",
    "requires_dist": [
      "dependency1 (>=1.0.0)",
      "dependency2 (<2.0.0)"
    ],
    "requires_python": ">=3.8",
    "summary": "Short package summary",
    "version": "1.0.0",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 12345678,
  "releases": {
    "0.1.0": [],
    "1.0.0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "abc...",
          "md5": "def...",
          "sha256": "ghi..."
        },
        "downloads": -1,
        "filename": "project_name-1.0.0-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "def...",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.8",
        "size": 12345,
        "upload_time": "2025-01-01T00:00:00",
        "upload_time_iso_8601": "2025-01-01T00:00:00.000000Z",
        "url": "https://files.pythonhosted.org/packages/.../project_name-1.0.0-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "abc...",
        "md5": "def...",
        "sha256": "ghi..."
      },
      "downloads": -1,
      "filename": "project_name-1.0.0-py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "def...",
      "packagetype": "bdist_wheel",
      "python_version": "py3",
      "requires_python": ">=3.8",
      "size": 12345,
      "upload_time": "2025-01-01T00:00:00",
      "upload_time_iso_8601": "2025-01-01T00:00:00.000000Z",
      "url": "https://files.pythonhosted.org/packages/.../project_name-1.0.0-py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": [
    {
      "aliases": ["CVE-2023-12345", "GHSA-xxxx-yyyy-zzzz"],
      "details": "Detailed vulnerability description...",
      "summary": "Brief vulnerability summary",
      "fixed_in": ["1.0.1", "2.0.0"],
      "id": "PYSEC-2023-123",
      "link": "https://osv.dev/vulnerability/PYSEC-2023-123",
      "source": "osv",
      "withdrawn": null
    }
  ]
}
```

##### 2. Specific Release
```
GET https://pypi.org/pypi/{project}/{version}/json
```

Same structure as project endpoint, but without the `releases` key.

##### 3. Simple API (PEP 503/691) - Package Index
```
GET https://pypi.org/simple/
GET https://pypi.org/simple/{project}/
```

**Request Headers:**
```
Accept: application/vnd.pypi.simple.v1+json
```

**Response (Project Index):**
```json
{
  "meta": {
    "api-version": "1.1",
    "_last-serial": 12345678
  },
  "name": "project-name",
  "versions": ["0.1.0", "1.0.0", "1.0.1"],
  "files": [
    {
      "filename": "project_name-1.0.0-py3-none-any.whl",
      "url": "https://files.pythonhosted.org/packages/.../project_name-1.0.0-py3-none-any.whl",
      "hashes": {
        "sha256": "abc123..."
      },
      "requires-python": ">=3.8",
      "size": 12345,
      "upload-time": "2025-01-01T00:00:00.000000Z",
      "yanked": false
    }
  ]
}
```

**API Versions:**
- 1.0 (PEP 691) - Initial JSON API
- 1.1 (PEP 700) - Added `versions`, `files[].size`, `files[].upload-time`
- 1.2+ - Added tracks metadata (PEP 708), provenance (PEP 740), status markers (PEP 792)

##### 4. Project Status Markers (2025)
```
GET https://pypi.org/simple/{project}/
```

Projects now include status markers:
- `active` - Default, actively maintained
- `archived` - No longer maintained
- `quarantined` - Security issues, use discouraged

Status is returned in both HTML and JSON Simple API responses.

### PyPI Data Structures

#### Info Object Fields

**Package Identity:**
- `name` - Package name (normalized)
- `version` - Current version
- `summary` - One-line description
- `description` - Full description (often markdown)
- `description_content_type` - MIME type of description
- `keywords` - Space-separated keywords

**Author/Maintainer:**
- `author` - Author name
- `author_email` - Author email
- `maintainer` - Maintainer name
- `maintainer_email` - Maintainer email

**Links:**
- `home_page` - Homepage URL
- `package_url` - PyPI package page
- `project_url` - Same as package_url
- `release_url` - Specific release URL
- `project_urls` - Dict of named URLs (homepage, docs, repo, issues, etc.)
- `download_url` - Download URL (often empty)
- `docs_url` - Documentation URL (deprecated)
- `bugtrack_url` - Bug tracker URL (deprecated)

**Dependencies:**
- `requires_dist` - Array of dependency specifiers (PEP 508)
- `requires_python` - Python version requirement
- `requires_external` - External system dependencies (rare)

**Classification:**
- `classifiers` - Array of trove classifiers
- `license` - License identifier or description
- `platform` - Supported platforms

**Metadata:**
- `downloads` - Download statistics (deprecated, always -1)
- `yanked` - Boolean, if release is yanked
- `yanked_reason` - Reason for yanking (if applicable)

**Deprecated Fields:**
- `downloads` - Always returns -1
- `has_sig` - PGP signatures deprecated
- `bugtrack_url` - Use `project_urls` instead

#### Release Object Fields

Each file in a release contains:

**File Identity:**
- `filename` - Distribution filename
- `packagetype` - `sdist`, `bdist_wheel`, `bdist_egg`, etc.
- `python_version` - Python version tag (e.g., `py3`, `cp311`)
- `size` - File size in bytes

**Checksums:**
- `digests` - Object with multiple hash algorithms:
  - `blake2b_256`
  - `md5`
  - `sha256`
- `md5_digest` - MD5 hash (deprecated)

**Download:**
- `url` - Download URL (files.pythonhosted.org)
- `downloads` - Download count (deprecated, always -1)
- `upload_time` - ISO 8601 timestamp (deprecated format)
- `upload_time_iso_8601` - ISO 8601 timestamp (preferred)

**Metadata:**
- `requires_python` - Python version requirement
- `yanked` - Boolean
- `yanked_reason` - String (if yanked)
- `comment_text` - Uploader comment (usually empty)
- `has_sig` - Boolean (deprecated, PGP signatures removed)

### PyPI Rate Limits & Authentication

#### Rate Limits

**No Official Hard Limits:**
- PyPI does not publish specific rate limits
- Requests should be reasonable and respectful
- Consider caching and conditional requests
- Use BigQuery for bulk analysis instead of API scraping

**Best Practices:**
- Implement exponential backoff
- Cache responses with appropriate TTLs
- Use conditional requests with `If-Modified-Since` / `ETag`
- Use BigQuery for data mining instead of scraping JSON API

#### Authentication

**Not Required For:**
- Public package metadata (JSON API)
- Simple API (package index)
- BigQuery public datasets

**Required For:**
- Publishing packages (API token)
- Package management operations
- Trusted publishing (OIDC)

**Methods:**
- API tokens (`.pypirc` configuration)
- Trusted Publishers (GitHub Actions OIDC)

### PyPI Bulk Download Approaches

#### 1. BigQuery Public Dataset (Recommended)

**Datasets:**
1. **File Downloads:** `bigquery-public-data.pypi.file_downloads`
2. **Distribution Metadata:** `bigquery-public-data.pypi.distribution_metadata`

**Access:**
- Free tier: 1TB queries/month
- Requires Google Cloud account
- Use `google-cloud-bigquery` Python package

**Distribution Metadata Schema:**
```sql
SELECT
  name,
  version,
  upload_time,
  filename,
  project_urls,
  requires_dist,
  requires_python,
  summary,
  author,
  author_email,
  maintainer,
  maintainer_email,
  license,
  classifiers,
  description
FROM `bigquery-public-data.pypi.distribution_metadata`
WHERE upload_time >= '2025-01-01'
LIMIT 1000
```

**File Downloads Schema:**
```sql
SELECT
  timestamp,
  country_code,
  file.filename,
  file.project,
  file.version,
  file.type,
  details.installer.name AS installer,
  details.python AS python_version,
  details.system.name AS os
FROM `bigquery-public-data.pypi.file_downloads`
WHERE DATE(timestamp) = CURRENT_DATE()
  AND file.project = 'requests'
```

**Advantages:**
- Complete historical data
- Immutable records (even for deleted packages)
- Powerful SQL queries
- Free tier available
- No rate limits for queries

#### 2. JSON API Crawling

**Strategy:**
```python
import requests
import time

# Get list of all projects from Simple API
response = requests.get(
    'https://pypi.org/simple/',
    headers={'Accept': 'application/vnd.pypi.simple.v1+json'}
)
projects = response.json()['projects']

# Fetch each project
for project in projects:
    try:
        url = f"https://pypi.org/pypi/{project['name']}/json"
        response = requests.get(url)
        data = response.json()

        # Store data
        save_to_database(data)

        # Be respectful
        time.sleep(0.1)

    except Exception as e:
        print(f"Error fetching {project['name']}: {e}")
        continue
```

**Considerations:**
- Slower than BigQuery
- Must respect server load
- No official rate limit documentation
- Risk of being blocked for excessive requests

#### 3. Simple API + Metadata

**List All Projects:**
```bash
curl -H "Accept: application/vnd.pypi.simple.v1+json" \
  https://pypi.org/simple/ | jq '.projects[].name'
```

**Fetch Project Metadata:**
```bash
cat projects.txt | while read project; do
  curl "https://pypi.org/pypi/$project/json" > "metadata/$project.json"
  sleep 0.1
done
```

#### 4. Mirrors and Tools

**Official Mirrors:**
- bandersnatch - PyPI mirror client (https://pypi.org/project/bandersnatch/)
- pip-audit - Security scanning tool

**Third-Party:**
- devpi - PyPI server and packaging tool
- Sonatype Nexus - Enterprise repository manager
- JFrog Artifactory - Universal package manager

---

## Security & Vulnerability Data

### NPM Security

#### 1. npm audit API
```
POST https://registry.npmjs.org/-/npm/v1/security/advisories/bulk
```

**Request Body:**
```json
{
  "package-name": ["1.0.0", "1.0.1", "2.0.0"]
}
```

**Response:**
```json
{
  "package-name": [
    {
      "id": 12345,
      "title": "Vulnerability title",
      "severity": "high",
      "vulnerable_versions": ">=1.0.0 <1.0.2",
      "patched_versions": ">=1.0.2",
      "overview": "Detailed description...",
      "recommendation": "Upgrade to version 1.0.2 or later",
      "references": ["https://cve.mitre.org/..."],
      "cves": ["CVE-2023-12345"],
      "url": "https://github.com/advisories/GHSA-xxxx-yyyy-zzzz"
    }
  ]
}
```

#### 2. GitHub Advisory Database
```
GET https://api.github.com/advisories?ecosystem=npm&affects=package-name
```

**Features:**
- 4,203+ npm-specific advisories
- Free-text search
- Structured vulnerability data
- CVE cross-references

**Query Parameters:**
- `ecosystem=npm`
- `affects=package-name`
- `severity=critical|high|medium|low`
- `cwe_ids=79,89` (Common Weakness Enumeration)

#### 3. Open Source Vulnerabilities (OSV)
```
POST https://api.osv.dev/v1/query
```

**Request:**
```json
{
  "package": {
    "name": "package-name",
    "ecosystem": "npm"
  },
  "version": "1.0.0"
}
```

**Response:**
```json
{
  "vulns": [
    {
      "id": "GHSA-xxxx-yyyy-zzzz",
      "summary": "Vulnerability summary",
      "details": "Detailed description...",
      "aliases": ["CVE-2023-12345"],
      "modified": "2025-01-01T00:00:00.000000Z",
      "published": "2023-06-01T00:00:00.000000Z",
      "database_specific": {
        "severity": "HIGH",
        "github_reviewed": true
      },
      "references": [
        {
          "type": "ADVISORY",
          "url": "https://github.com/advisories/GHSA-xxxx-yyyy-zzzz"
        },
        {
          "type": "WEB",
          "url": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-12345"
        }
      ],
      "affected": [
        {
          "package": {
            "name": "package-name",
            "ecosystem": "npm"
          },
          "ranges": [
            {
              "type": "SEMVER",
              "events": [
                {
                  "introduced": "1.0.0"
                },
                {
                  "fixed": "1.0.2"
                }
              ]
            }
          ],
          "database_specific": {
            "source": "https://github.com/github/advisory-database"
          }
        }
      ]
    }
  ]
}
```

**Bulk Download:**
```bash
# Download all npm vulnerabilities
curl https://osv-vulnerabilities.storage.googleapis.com/npm/all.zip
```

### PyPI Security

#### 1. PyPI Advisory Database
- **Repository:** https://github.com/pypa/advisory-database
- **Format:** YAML files in `vulns/` directory
- **Integration:** OSV.dev, pip-audit

**Structure:**
```yaml
id: PYSEC-2023-123
package: package-name
aliases:
  - CVE-2023-12345
  - GHSA-xxxx-yyyy-zzzz
summary: Brief vulnerability summary
details: |
  Detailed vulnerability description...
severity:
  - type: CVSS_V3
    score: 7.5
affects:
  ranges:
    - type: ECOSYSTEM
      events:
        - introduced: 1.0.0
        - fixed: 1.0.2
references:
  - type: ADVISORY
    url: https://osv.dev/vulnerability/PYSEC-2023-123
  - type: WEB
    url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-12345
```

#### 2. PyPI JSON API Vulnerabilities
```
GET https://pypi.org/pypi/{project}/json
```

Includes `vulnerabilities` array in response (see PyPI API response structure above).

#### 3. OSV Database
```
POST https://api.osv.dev/v1/query
```

**Request:**
```json
{
  "package": {
    "name": "package-name",
    "ecosystem": "PyPI"
  },
  "version": "1.0.0"
}
```

**Bulk Download:**
```bash
# Download all PyPI vulnerabilities
curl https://osv-vulnerabilities.storage.googleapis.com/PyPI/all.zip
```

#### 4. pip-audit
```bash
# Audit installed packages
pip-audit

# Audit requirements file
pip-audit -r requirements.txt

# Output as JSON
pip-audit --format json
```

**Uses:**
- PyPI JSON API (vulnerabilities field)
- PyPA Advisory Database (via OSV)

#### 5. Safety DB
```bash
# Install
pip install safety

# Audit
safety check

# Use with JSON output
safety check --json
```

---

## Best Practices

### Incremental Update Strategies

#### NPM

**1. Sequence-Based Updates:**
```javascript
let lastSeq = loadLastSequence() || 0;

async function syncPackages() {
  const changes = await fetch(
    `https://replicate.npmjs.com/registry/_changes?since=${lastSeq}&limit=10000`
  ).then(r => r.json());

  for (const change of changes.results) {
    await syncPackage(change.id);
  }

  saveLastSequence(changes.last_seq);
  lastSeq = changes.last_seq;
}

// Run periodically
setInterval(syncPackages, 60000); // Every minute
```

**2. Timestamp-Based Updates:**
```javascript
// Store modification timestamps
const packageTimestamps = {}; // { "package-name": "2025-01-01T00:00:00Z" }

async function updatePackage(name) {
  const packument = await fetch(`https://registry.npmjs.org/${name}`).then(r => r.json());

  const lastModified = packument.time.modified;
  const stored = packageTimestamps[name];

  if (!stored || new Date(lastModified) > new Date(stored)) {
    // Package updated, save new data
    savePackage(packument);
    packageTimestamps[name] = lastModified;
  }
}
```

#### PyPI

**1. Serial-Based Updates (JSON API):**
```python
import requests

last_serial = load_last_serial() or 0

def sync_packages():
    # Fetch all projects
    response = requests.get(
        'https://pypi.org/simple/',
        headers={'Accept': 'application/vnd.pypi.simple.v1+json'}
    )
    projects = response.json()['projects']

    for project in projects:
        name = project['name']

        # Get project metadata
        response = requests.get(f"https://pypi.org/pypi/{name}/json")
        data = response.json()

        if data['last_serial'] > last_serial:
            # Updated since last sync
            save_package(data)
            last_serial = data['last_serial']

    save_last_serial(last_serial)
```

**2. BigQuery Incremental (Recommended):**
```sql
-- Get packages updated since last sync
SELECT *
FROM `bigquery-public-data.pypi.distribution_metadata`
WHERE upload_time > @last_sync_timestamp
ORDER BY upload_time ASC
```

### Efficient Mirroring

#### NPM

**1. Parallel Fetching:**
```javascript
const queue = require('p-queue').default;
const limit = new queue({ concurrency: 10 });

async function fetchPackages(names) {
  const promises = names.map(name =>
    limit.add(() => fetchPackage(name))
  );

  await Promise.all(promises);
}
```

**2. Conditional Requests:**
```javascript
const etags = {}; // Store ETags

async function fetchPackage(name) {
  const headers = {};

  if (etags[name]) {
    headers['If-None-Match'] = etags[name];
  }

  const response = await fetch(`https://registry.npmjs.org/${name}`, { headers });

  if (response.status === 304) {
    // Not modified
    return null;
  }

  etags[name] = response.headers.get('ETag');
  return await response.json();
}
```

**3. Use CDN Cache:**
```javascript
// registry.npmjs.org is CDN-backed
// Cache-friendly requests reduce load and improve speed
const headers = {
  'Accept': 'application/vnd.npm.install-v1+json', // Minimal metadata
  'Accept-Encoding': 'gzip, deflate, br'
};
```

#### PyPI

**1. Use BigQuery for Bulk:**
```python
from google.cloud import bigquery

client = bigquery.Client()

# Query all packages
query = """
SELECT DISTINCT name, MAX(upload_time) as latest_upload
FROM `bigquery-public-data.pypi.distribution_metadata`
GROUP BY name
"""

results = client.query(query).result()
packages = {row.name: row.latest_upload for row in results}
```

**2. Conditional Requests:**
```python
import requests

session = requests.Session()
cache = {}  # { "package-name": { "etag": "...", "last-modified": "..." } }

def fetch_package(name):
    headers = {}

    if name in cache:
        if 'etag' in cache[name]:
            headers['If-None-Match'] = cache[name]['etag']
        if 'last-modified' in cache[name]:
            headers['If-Modified-Since'] = cache[name]['last-modified']

    response = session.get(f"https://pypi.org/pypi/{name}/json", headers=headers)

    if response.status_code == 304:
        # Not modified
        return None

    cache[name] = {
        'etag': response.headers.get('ETag'),
        'last-modified': response.headers.get('Last-Modified')
    }

    return response.json()
```

### Download Statistics

#### NPM

**Bulk Package Stats:**
```javascript
// Fetch up to 128 packages at once
const packages = ['react', 'vue', 'angular', /* ... up to 128 */];
const url = `https://api.npmjs.org/downloads/point/last-month/${packages.join(',')}`;

const stats = await fetch(url).then(r => r.json());

for (const [pkg, data] of Object.entries(stats)) {
  console.log(`${pkg}: ${data.downloads} downloads`);
}
```

**Historical Data:**
```javascript
// Daily breakdown for custom date range
const url = 'https://api.npmjs.org/downloads/range/2025-01-01:2025-01-31/react';
const data = await fetch(url).then(r => r.json());

for (const day of data.downloads) {
  console.log(`${day.day}: ${day.downloads}`);
}
```

#### PyPI

**BigQuery Download Stats:**
```sql
-- Total downloads per package (last 30 days)
SELECT
  file.project,
  COUNT(*) as downloads
FROM `bigquery-public-data.pypi.file_downloads`
WHERE DATE(timestamp) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)
GROUP BY file.project
ORDER BY downloads DESC
LIMIT 100
```

**Detailed Analytics:**
```sql
-- Downloads by Python version
SELECT
  file.project,
  details.python as python_version,
  COUNT(*) as downloads
FROM `bigquery-public-data.pypi.file_downloads`
WHERE DATE(timestamp) = CURRENT_DATE()
  AND file.project = 'requests'
GROUP BY file.project, python_version
ORDER BY downloads DESC
```

### Caching Strategies

**1. Response Caching:**
```javascript
const cache = new Map();
const TTL = 3600000; // 1 hour

async function fetchWithCache(url) {
  const cached = cache.get(url);

  if (cached && Date.now() - cached.timestamp < TTL) {
    return cached.data;
  }

  const data = await fetch(url).then(r => r.json());
  cache.set(url, { data, timestamp: Date.now() });

  return data;
}
```

**2. Database Caching:**
```sql
-- Store package metadata with timestamps
CREATE TABLE packages (
  name TEXT PRIMARY KEY,
  metadata JSONB,
  last_updated TIMESTAMP,
  last_checked TIMESTAMP
);

-- Only re-fetch if stale
SELECT name FROM packages
WHERE last_checked < NOW() - INTERVAL '1 hour';
```

**3. CDN/Proxy Caching:**
```nginx
# Nginx reverse proxy with caching
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=registry:10m;

server {
  location /npm/ {
    proxy_pass https://registry.npmjs.org/;
    proxy_cache registry;
    proxy_cache_valid 200 1h;
    proxy_cache_use_stale error timeout updating;
  }

  location /pypi/ {
    proxy_pass https://pypi.org/;
    proxy_cache registry;
    proxy_cache_valid 200 1h;
    proxy_cache_use_stale error timeout updating;
  }
}
```

---

## Example API Responses

### NPM Packument (Full)

```json
{
  "_id": "express",
  "_rev": "123-abc456def",
  "name": "express",
  "description": "Fast, unopinionated, minimalist web framework",
  "dist-tags": {
    "latest": "4.18.2",
    "next": "5.0.0-beta.1"
  },
  "versions": {
    "4.18.2": {
      "name": "express",
      "version": "4.18.2",
      "description": "Fast, unopinionated, minimalist web framework",
      "author": {
        "name": "TJ Holowaychuk",
        "email": "tj@vision-media.ca"
      },
      "contributors": [
        {
          "name": "Aaron Heckmann",
          "email": "aaron.heckmann+github@gmail.com"
        },
        {
          "name": "Douglas Christopher Wilson",
          "email": "doug@somethingdoug.com"
        }
      ],
      "license": "MIT",
      "repository": {
        "type": "git",
        "url": "git+https://github.com/expressjs/express.git"
      },
      "homepage": "http://expressjs.com/",
      "keywords": [
        "express",
        "framework",
        "sinatra",
        "web",
        "http",
        "rest",
        "restful",
        "router",
        "app",
        "api"
      ],
      "dependencies": {
        "accepts": "~1.3.8",
        "array-flatten": "1.1.1",
        "body-parser": "1.20.1",
        "content-disposition": "0.5.4",
        "cookie": "0.5.0",
        "cookie-signature": "1.0.6",
        "debug": "2.6.9",
        "depd": "2.0.0",
        "encodeurl": "~1.0.2",
        "escape-html": "~1.0.3",
        "etag": "~1.8.1",
        "finalhandler": "1.2.0",
        "fresh": "0.5.2",
        "http-errors": "2.0.0",
        "merge-descriptors": "1.0.1",
        "methods": "~1.1.2",
        "on-finished": "2.4.1",
        "parseurl": "~1.3.3",
        "path-to-regexp": "0.1.7",
        "proxy-addr": "~2.0.7",
        "qs": "6.11.0",
        "range-parser": "~1.2.1",
        "safe-buffer": "5.2.1",
        "send": "0.18.0",
        "serve-static": "1.15.0",
        "setprototypeof": "1.2.0",
        "statuses": "2.0.1",
        "type-is": "~1.6.18",
        "utils-merge": "1.0.1",
        "vary": "~1.1.2"
      },
      "devDependencies": {
        "after": "0.8.2",
        "connect-redis": "3.4.2",
        "cookie-parser": "1.4.6",
        "cookie-session": "2.0.0",
        "ejs": "3.1.8",
        "eslint": "8.24.0",
        "express-session": "1.17.3",
        "hbs": "4.2.0",
        "marked": "4.1.0",
        "method-override": "3.0.0",
        "mocha": "10.0.0",
        "morgan": "1.10.0",
        "multiparty": "4.2.3",
        "nyc": "15.1.0",
        "pbkdf2-password": "1.2.1",
        "supertest": "6.3.0",
        "vhost": "~3.0.2"
      },
      "engines": {
        "node": ">= 0.10.0"
      },
      "scripts": {
        "lint": "eslint .",
        "test": "mocha --require test/support/env --reporter spec --bail --check-leaks test/ test/acceptance/",
        "test-ci": "nyc --reporter=lcov --reporter=text npm test",
        "test-cov": "nyc --reporter=html --reporter=text npm test",
        "test-tap": "mocha --require test/support/env --reporter tap --check-leaks test/ test/acceptance/"
      },
      "dist": {
        "shasum": "8df3d5a9ac848585f00a0777601823faecd3b148",
        "tarball": "https://registry.npmjs.org/express/-/express-4.18.2.tgz",
        "integrity": "sha512-5/PsL6iGPdfQ/lKM1UuielYgv3BUoJfz1aUwU9vHZ+J7gyvwdQXFEBIEIaxeGf0GIcreATNyBExtalisDbuMqQ==",
        "fileCount": 16,
        "unpackedSize": 214925
      },
      "gitHead": "4c0e8cf8e6e1f3a4e85c3ddbe0b5c9e8e0e5c7a9",
      "_id": "express@4.18.2",
      "_nodeVersion": "16.17.0",
      "_npmVersion": "8.15.0",
      "_npmUser": {
        "name": "dougwilson",
        "email": "doug@somethingdoug.com"
      },
      "maintainers": [
        {
          "name": "dougwilson",
          "email": "doug@somethingdoug.com"
        }
      ]
    }
  },
  "time": {
    "created": "2010-12-29T19:38:25.450Z",
    "modified": "2023-10-09T21:24:35.371Z",
    "4.18.2": "2022-10-08T22:04:18.885Z"
  },
  "maintainers": [
    {
      "name": "dougwilson",
      "email": "doug@somethingdoug.com"
    }
  ],
  "repository": {
    "type": "git",
    "url": "git+https://github.com/expressjs/express.git"
  },
  "users": {
    "user1": true,
    "user2": true
  },
  "homepage": "http://expressjs.com/",
  "keywords": [
    "express",
    "framework",
    "sinatra",
    "web",
    "http",
    "rest",
    "restful",
    "router",
    "app",
    "api"
  ],
  "bugs": {
    "url": "https://github.com/expressjs/express/issues"
  },
  "license": "MIT",
  "readme": "# Express\n\n[![NPM Version][npm-version-image]][npm-url]...",
  "readmeFilename": "Readme.md"
}
```

### NPM Search Response

```json
{
  "objects": [
    {
      "package": {
        "name": "express",
        "scope": "unscoped",
        "version": "4.18.2",
        "description": "Fast, unopinionated, minimalist web framework",
        "keywords": [
          "express",
          "framework",
          "sinatra",
          "web",
          "http",
          "rest",
          "restful",
          "router",
          "app",
          "api"
        ],
        "date": "2022-10-08T22:04:18.885Z",
        "links": {
          "npm": "https://www.npmjs.com/package/express",
          "homepage": "http://expressjs.com/",
          "repository": "https://github.com/expressjs/express",
          "bugs": "https://github.com/expressjs/express/issues"
        },
        "author": {
          "name": "TJ Holowaychuk",
          "email": "tj@vision-media.ca"
        },
        "publisher": {
          "username": "dougwilson",
          "email": "doug@somethingdoug.com"
        },
        "maintainers": [
          {
            "username": "dougwilson",
            "email": "doug@somethingdoug.com"
          }
        ]
      },
      "flags": {
        "unstable": false
      },
      "score": {
        "final": 0.9234567890123456,
        "detail": {
          "quality": 0.9345678901234567,
          "popularity": 0.8901234567890123,
          "maintenance": 0.9456789012345678
        }
      },
      "searchScore": 100000.42
    }
  ],
  "total": 1234,
  "time": "Wed Oct 03 2025 12:00:00 GMT+0000 (UTC)"
}
```

### NPM Downloads API Response

**Point Query:**
```json
{
  "downloads": 43556160,
  "start": "2025-09-03",
  "end": "2025-10-02",
  "package": "express"
}
```

**Range Query:**
```json
{
  "downloads": [
    {
      "downloads": 1234567,
      "day": "2025-09-03"
    },
    {
      "downloads": 1345678,
      "day": "2025-09-04"
    },
    {
      "downloads": 1456789,
      "day": "2025-09-05"
    }
  ],
  "start": "2025-09-03",
  "end": "2025-10-02",
  "package": "express"
}
```

**Bulk Query:**
```json
{
  "express": {
    "downloads": 43556160,
    "start": "2025-09-03",
    "end": "2025-10-02",
    "package": "express"
  },
  "koa": {
    "downloads": 1234567,
    "start": "2025-09-03",
    "end": "2025-10-02",
    "package": "koa"
  },
  "fastify": {
    "downloads": 987654,
    "start": "2025-09-03",
    "end": "2025-10-02",
    "package": "fastify"
  }
}
```

### PyPI JSON API Response

**Project (Latest Version):**
```json
{
  "info": {
    "author": "Kenneth Reitz",
    "author_email": "me@kennethreitz.org",
    "bugtrack_url": null,
    "classifiers": [
      "Development Status :: 5 - Production/Stable",
      "Environment :: Web Environment",
      "Intended Audience :: Developers",
      "License :: OSI Approved :: Apache Software License",
      "Natural Language :: English",
      "Operating System :: OS Independent",
      "Programming Language :: Python",
      "Programming Language :: Python :: 3",
      "Programming Language :: Python :: 3.7",
      "Programming Language :: Python :: 3.8",
      "Programming Language :: Python :: 3.9",
      "Programming Language :: Python :: 3.10",
      "Programming Language :: Python :: 3.11",
      "Programming Language :: Python :: Implementation :: CPython",
      "Programming Language :: Python :: Implementation :: PyPy",
      "Topic :: Internet :: WWW/HTTP",
      "Topic :: Software Development :: Libraries"
    ],
    "description": "# Requests\n\nRequests is an elegant and simple HTTP library for Python...",
    "description_content_type": "text/markdown",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "https://requests.readthedocs.io",
    "keywords": "http, requests, web, client",
    "license": "Apache 2.0",
    "maintainer": "",
    "maintainer_email": "",
    "name": "requests",
    "package_url": "https://pypi.org/project/requests/",
    "platform": null,
    "project_url": "https://pypi.org/project/requests/",
    "project_urls": {
      "Documentation": "https://requests.readthedocs.io",
      "Source": "https://github.com/psf/requests"
    },
    "release_url": "https://pypi.org/project/requests/2.31.0/",
    "requires_dist": [
      "charset-normalizer (<4,>=2)",
      "idna (<4,>=2.5)",
      "urllib3 (<3,>=1.21.1)",
      "certifi (>=2017.4.17)",
      "PySocks (!=1.5.7,>=1.5.6) ; extra == 'socks'",
      "chardet (<6,>=3.0.2) ; extra == 'use_chardet_on_py3'"
    ],
    "requires_python": ">=3.7",
    "summary": "Python HTTP for Humans.",
    "version": "2.31.0",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 18125614,
  "releases": {
    "0.2.0": [],
    "0.2.1": [],
    "2.31.0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "70886fb01497adcf1c0a47b0c9c9c3c5d0b6c8c2ccd16b1e9c3c4c5c3b1f3e1a",
          "md5": "941e175f6a4e0e3d8e3f9f0e9a0e9e9e",
          "sha256": "942c5a758f98d5e8e9a3e9e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e"
        },
        "downloads": -1,
        "filename": "requests-2.31.0-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "941e175f6a4e0e3d8e3f9f0e9a0e9e9e",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.7",
        "size": 62574,
        "upload_time": "2023-05-22T13:30:00",
        "upload_time_iso_8601": "2023-05-22T13:30:00.123456Z",
        "url": "https://files.pythonhosted.org/packages/70/88/6fb01497adcf1c0a47b0c9c9c3c5d0b6c8c2ccd16b1e9c3c4c5c3b1f3e1a/requests-2.31.0-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "9d26a78a9e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e",
          "md5": "a8b8c8c8c8c8c8c8c8c8c8c8c8c8c8c8",
          "sha256": "a8b8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8"
        },
        "downloads": -1,
        "filename": "requests-2.31.0.tar.gz",
        "has_sig": false,
        "md5_digest": "a8b8c8c8c8c8c8c8c8c8c8c8c8c8c8c8",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.7",
        "size": 110794,
        "upload_time": "2023-05-22T13:30:02",
        "upload_time_iso_8601": "2023-05-22T13:30:02.123456Z",
        "url": "https://files.pythonhosted.org/packages/9d/26/a78a9e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e/requests-2.31.0.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "70886fb01497adcf1c0a47b0c9c9c3c5d0b6c8c2ccd16b1e9c3c4c5c3b1f3e1a",
        "md5": "941e175f6a4e0e3d8e3f9f0e9a0e9e9e",
        "sha256": "942c5a758f98d5e8e9a3e9e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e"
      },
      "downloads": -1,
      "filename": "requests-2.31.0-py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "941e175f6a4e0e3d8e3f9f0e9a0e9e9e",
      "packagetype": "bdist_wheel",
      "python_version": "py3",
      "requires_python": ">=3.7",
      "size": 62574,
      "upload_time": "2023-05-22T13:30:00",
      "upload_time_iso_8601": "2023-05-22T13:30:00.123456Z",
      "url": "https://files.pythonhosted.org/packages/70/88/6fb01497adcf1c0a47b0c9c9c3c5d0b6c8c2ccd16b1e9c3c4c5c3b1f3e1a/requests-2.31.0-py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    },
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "9d26a78a9e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e",
        "md5": "a8b8c8c8c8c8c8c8c8c8c8c8c8c8c8c8",
        "sha256": "a8b8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8"
      },
      "downloads": -1,
      "filename": "requests-2.31.0.tar.gz",
      "has_sig": false,
      "md5_digest": "a8b8c8c8c8c8c8c8c8c8c8c8c8c8c8c8",
      "packagetype": "sdist",
      "python_version": "source",
      "requires_python": ">=3.7",
      "size": 110794,
      "upload_time": "2023-05-22T13:30:02",
      "upload_time_iso_8601": "2023-05-22T13:30:02.123456Z",
      "url": "https://files.pythonhosted.org/packages/9d/26/a78a9e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e/requests-2.31.0.tar.gz",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}
```

### PyPI Simple API (PEP 691) Response

```json
{
  "meta": {
    "api-version": "1.1",
    "_last-serial": 18125614
  },
  "name": "requests",
  "versions": ["0.2.0", "0.2.1", "2.30.0", "2.31.0"],
  "files": [
    {
      "filename": "requests-2.31.0-py3-none-any.whl",
      "url": "https://files.pythonhosted.org/packages/70/88/6fb01497adcf1c0a47b0c9c9c3c5d0b6c8c2ccd16b1e9c3c4c5c3b1f3e1a/requests-2.31.0-py3-none-any.whl",
      "hashes": {
        "sha256": "942c5a758f98d5e8e9a3e9e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e"
      },
      "requires-python": ">=3.7",
      "size": 62574,
      "upload-time": "2023-05-22T13:30:00.123456Z",
      "yanked": false
    },
    {
      "filename": "requests-2.31.0.tar.gz",
      "url": "https://files.pythonhosted.org/packages/9d/26/a78a9e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e3e/requests-2.31.0.tar.gz",
      "hashes": {
        "sha256": "a8b8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8"
      },
      "requires-python": ">=3.7",
      "size": 110794,
      "upload-time": "2023-05-22T13:30:02.123456Z",
      "yanked": false
    }
  ]
}
```

---

## Summary & Recommendations

### NPM Registry

**Strengths:**
- CouchDB-based replication API for mirroring
- Comprehensive packument metadata
- Powerful search API with scoring
- Download statistics API
- Well-documented (GitHub registry repo)

**Challenges:**
- 2025 API changes removed `include_docs` bulk metadata
- Limited official rate limit documentation
- Replication endpoint reliability issues reported
- Must fetch packages individually for full metadata

**Recommended Approach:**
1. Use `_changes` endpoint for incremental updates (sequence-based)
2. Fetch individual packages via registry API
3. Use download stats API for popularity metrics
4. Consider third-party mirrors (Verdaccio, Nexus) for caching
5. Implement exponential backoff and caching

### PyPI Registry

**Strengths:**
- BigQuery public dataset (best for bulk analysis)
- Clean JSON API with vulnerability data
- PEP 691 Simple API (modern, standardized)
- Project status markers (2025)
- OSV integration for security

**Challenges:**
- No official rate limits published
- No bulk metadata endpoint (must scrape)
- JSON API doesn't list all packages (use Simple API)
- Download stats only via BigQuery (not API)

**Recommended Approach:**
1. Use BigQuery for bulk metadata and download stats
2. Use JSON API for real-time package lookups
3. Use Simple API (PEP 691) for package lists
4. Implement serial-based incremental updates
5. Cache aggressively with ETags

### Security Data

**Best Practices:**
- Use OSV API for unified vulnerability data (npm + PyPI)
- Integrate GitHub Advisory Database for npm
- Use PyPA Advisory Database for PyPI (via OSV)
- Bulk download via OSV GCS bucket for offline analysis
- Implement vulnerability scanning in CI/CD

### General Recommendations

1. **Start with bulk download** (BigQuery for PyPI, replication API for npm)
2. **Implement incremental updates** (sequence/serial-based)
3. **Cache aggressively** (ETags, Last-Modified headers)
4. **Respect rate limits** (exponential backoff, parallel limits)
5. **Use CDN-friendly patterns** (conditional requests)
6. **Monitor for API changes** (subscribe to registry changelogs)
7. **Consider mirrors/proxies** (Nexus, Artifactory, Verdaccio, devpi)
8. **Security first** (integrate vulnerability scanning)

---

**Last Updated:** 2025-10-03
**Sources:** Official NPM/PyPI documentation, PEPs, GitHub repositories, OSV.dev
