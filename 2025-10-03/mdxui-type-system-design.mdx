# MDXUI Type System Design
## Deep Dive Technical Specification

**Date:** October 3, 2025
**Related:** [Main Plan](2025-10-03-mdxui-simplification-plan.md) | [GitHub Issue #6](https://github.com/dot-do/.do/issues/6)
**Status:** Specification - Ready for Implementation

---

## Table of Contents

1. [Overview](#overview)
2. [Package Architecture](#package-architecture)
3. [Core Type Hierarchy](#core-type-hierarchy)
4. [Component Categories](#component-categories)
5. [Dual API Types](#dual-api-types)
6. [Variant Systems](#variant-systems)
7. [Theme Types](#theme-types)
8. [Implementation Details](#implementation-details)

---

## Overview

The **MDXUI Type System** provides comprehensive TypeScript types for all components, ensuring type safety across:
- Component props (explicit API)
- MDX children (semantic API)
- Theme configuration
- Variant systems
- Implementation-specific extensions

### Design Principles

1. **Strict by Default:** No `any` types, full inference
2. **Composable:** Types build on each other
3. **Extensible:** Easy to add custom types
4. **Cross-Implementation:** Types work across all UI library implementations
5. **Developer-Friendly:** Clear errors, great autocomplete

---

## Package Architecture

### Package Structure

```
@mdxui/types/
├── src/
│   ├── components/
│   │   ├── marketing/
│   │   │   ├── hero.ts
│   │   │   ├── features.ts
│   │   │   ├── pricing.ts
│   │   │   ├── testimonials.ts
│   │   │   ├── faq.ts
│   │   │   ├── cta.ts
│   │   │   ├── team.ts
│   │   │   └── index.ts
│   │   ├── docs/
│   │   │   ├── page.ts
│   │   │   ├── sidebar.ts
│   │   │   ├── toc.ts
│   │   │   ├── code-block.ts
│   │   │   ├── callout.ts
│   │   │   ├── tabs.ts
│   │   │   └── index.ts
│   │   ├── dashboard/
│   │   │   ├── chart.ts
│   │   │   ├── kpi-card.ts
│   │   │   ├── data-table.ts
│   │   │   ├── grid.ts
│   │   │   └── index.ts
│   │   ├── chat/
│   │   │   ├── interface.ts
│   │   │   ├── message.ts
│   │   │   ├── input.ts
│   │   │   └── index.ts
│   │   ├── base/
│   │   │   ├── button.ts
│   │   │   ├── card.ts
│   │   │   ├── input.ts
│   │   │   └── index.ts
│   │   └── index.ts
│   ├── theme/
│   │   ├── colors.ts
│   │   ├── typography.ts
│   │   ├── spacing.ts
│   │   ├── variants.ts
│   │   └── index.ts
│   ├── utils/
│   │   ├── polymorphic.ts
│   │   ├── as-child.ts
│   │   ├── variant-props.ts
│   │   └── index.ts
│   ├── shared/
│   │   ├── common.ts
│   │   ├── react.ts
│   │   └── mdx.ts
│   └── index.ts
├── package.json
└── tsconfig.json
```

---

## Core Type Hierarchy

### Base Component Type

All component types extend from a common base:

```typescript
/**
 * Base props shared by all mdxui components
 */
export interface BaseComponentProps {
  /**
   * Optional CSS class name
   */
  className?: string

  /**
   * Optional inline styles
   */
  style?: React.CSSProperties

  /**
   * Data attributes for testing/analytics
   */
  'data-testid'?: string
  [key: `data-${string}`]: string | undefined

  /**
   * ARIA attributes for accessibility
   */
  'aria-label'?: string
  'aria-labelledby'?: string
  'aria-describedby'?: string
  [key: `aria-${string}`]: string | boolean | undefined
}

/**
 * Props that support MDX children
 */
export interface MDXChildrenProps {
  /**
   * MDX children - can be React nodes or parsed from markdown
   */
  children?: React.ReactNode
}

/**
 * Complete base for all components
 */
export type ComponentProps<T = {}> = BaseComponentProps & T & MDXChildrenProps
```

### Polymorphic Components

Components that can render as different HTML elements:

```typescript
/**
 * Polymorphic component types
 * Allows component to render as any HTML element
 */
export type AsProp<C extends React.ElementType> = {
  as?: C
}

export type PropsToOmit<C extends React.ElementType, P> = keyof (AsProp<C> & P)

export type PolymorphicComponentProp<
  C extends React.ElementType,
  Props = {}
> = React.PropsWithChildren<Props & AsProp<C>> &
  Omit<React.ComponentPropsWithoutRef<C>, PropsToOmit<C, Props>>

export type PolymorphicRef<C extends React.ElementType> =
  React.ComponentPropsWithRef<C>['ref']

export type PolymorphicComponentPropWithRef<
  C extends React.ElementType,
  Props = {}
> = PolymorphicComponentProp<C, Props> & { ref?: PolymorphicRef<C> }
```

Usage:

```typescript
// Button can be rendered as 'button', 'a', or any other element
type ButtonProps<C extends React.ElementType = 'button'> =
  PolymorphicComponentPropWithRef<
    C,
    {
      variant?: 'primary' | 'secondary' | 'outline'
      size?: 'sm' | 'md' | 'lg'
    }
  >

const Button = <C extends React.ElementType = 'button'>(
  props: ButtonProps<C>
) => {
  // Implementation
}

// Usage:
<Button as="a" href="/signup">Get Started</Button>
<Button as="button" onClick={handler}>Click Me</Button>
```

---

## Component Categories

### 1. Marketing Components

```typescript
// src/components/marketing/hero.ts

/**
 * Hero section props
 * The attention-grabbing top section of a landing page
 */
export interface HeroSectionProps extends ComponentProps {
  /**
   * Main headline to grab attention
   * @example "Transform Your Workflow"
   */
  headline: string

  /**
   * Supporting text to elaborate on headline
   * @example "Build faster with AI-powered tools"
   */
  description: string

  /**
   * Primary call-to-action text (prominent button)
   * @example "Get Started Free"
   */
  primaryActionText: string

  /**
   * Primary call-to-action link URL
   * @example "/signup"
   */
  primaryActionLink: string

  /**
   * Optional secondary call-to-action text
   * @example "Watch Demo"
   */
  secondaryActionText?: string

  /**
   * Optional secondary call-to-action link URL
   * @example "/demo"
   */
  secondaryActionLink?: string

  /**
   * Optional badge or eyebrow text above headline
   * @example "New Feature"
   */
  badge?: string

  /**
   * Optional image, video, or illustration URL
   */
  mediaUrl?: string

  /**
   * Alternate text for media
   */
  mediaAlt?: string

  /**
   * Media type
   * @default "image"
   */
  mediaType?: 'image' | 'video'

  /**
   * Background animation (MagicUI)
   * @example "particles" | "warp" | "grid"
   */
  background?: string

  /**
   * Layout variant
   * @default "center"
   */
  layout?: 'center' | 'left' | 'right' | 'split'

  /**
   * Color theme
   * @default "default"
   */
  theme?: 'default' | 'dark' | 'gradient'
}
```

```typescript
// src/components/marketing/features.ts

/**
 * Individual feature item
 */
export interface FeatureItem {
  /**
   * Feature title
   * @example "Fast"
   */
  title: string

  /**
   * Feature description
   * @example "Ship 10x faster with AI"
   */
  description?: string

  /**
   * Optional icon URL or icon name
   */
  icon?: string

  /**
   * Icon alt text
   */
  iconAlt?: string

  /**
   * Optional link for "learn more"
   */
  link?: string
}

/**
 * Features section props
 * Highlights what the product offers
 */
export interface FeaturesSectionProps extends ComponentProps {
  /**
   * Section headline
   * @example "Key Features"
   */
  headline?: string

  /**
   * Section description
   */
  description?: string

  /**
   * List of features
   */
  features: FeatureItem[]

  /**
   * Layout style
   * @default "grid"
   */
  layout?: 'grid' | 'list' | 'cards'

  /**
   * Number of columns (for grid layout)
   * @default 3
   */
  columns?: 2 | 3 | 4

  /**
   * Feature card variant
   * @default "default"
   */
  variant?: 'default' | 'minimal' | 'detailed'
}
```

### 2. Documentation Components

```typescript
// src/components/docs/page.ts

/**
 * Documentation page props
 */
export interface DocsPageProps extends ComponentProps {
  /**
   * Page title
   */
  title: string

  /**
   * Page description
   */
  description?: string

  /**
   * Show sidebar
   * @default true
   */
  sidebar?: boolean

  /**
   * Show table of contents
   * @default true
   */
  toc?: boolean

  /**
   * Breadcrumb items
   */
  breadcrumbs?: Array<{
    label: string
    href: string
  }>

  /**
   * Previous page link
   */
  prev?: {
    label: string
    href: string
  }

  /**
   * Next page link
   */
  next?: {
    label: string
    href: string
  }

  /**
   * Last updated date
   */
  lastUpdated?: Date

  /**
   * Contributors
   */
  contributors?: string[]
}
```

```typescript
// src/components/docs/code-block.ts

/**
 * Code block props
 */
export interface CodeBlockProps extends ComponentProps {
  /**
   * Programming language
   * @example "typescript"
   */
  language?: string

  /**
   * Code content
   */
  code: string

  /**
   * Optional filename
   * @example "App.tsx"
   */
  filename?: string

  /**
   * Show line numbers
   * @default false
   */
  lineNumbers?: boolean

  /**
   * Highlight specific lines
   * @example [1, 5, 10]
   */
  highlightLines?: number[]

  /**
   * Show copy button
   * @default true
   */
  showCopy?: boolean

  /**
   * Theme
   * @default "github-dark"
   */
  theme?: string

  /**
   * Max height before scrolling
   */
  maxHeight?: string | number
}
```

### 3. Dashboard Components

```typescript
// src/components/dashboard/chart.ts

/**
 * Chart data point
 */
export interface ChartDataPoint {
  [key: string]: string | number | Date
}

/**
 * Base chart props (extends Tremor chart props)
 */
export interface BaseChartProps extends ComponentProps {
  /**
   * Chart data
   */
  data: ChartDataPoint[]

  /**
   * Index field (x-axis)
   * @example "month"
   */
  index: string

  /**
   * Data categories to display
   * @example ["revenue", "profit"]
   */
  categories: string[]

  /**
   * Colors for each category
   */
  colors?: string[]

  /**
   * Show legend
   * @default true
   */
  showLegend?: boolean

  /**
   * Show grid lines
   * @default true
   */
  showGridLines?: boolean

  /**
   * Chart height
   * @default "h-80"
   */
  height?: string | number

  /**
   * Value formatter function
   */
  valueFormatter?: (value: number) => string
}

/**
 * Area chart props
 */
export interface AreaChartProps extends BaseChartProps {
  /**
   * Fill opacity
   * @default 0.3
   */
  fillOpacity?: number

  /**
   * Enable stacking
   * @default false
   */
  stack?: boolean
}

/**
 * Bar chart props
 */
export interface BarChartProps extends BaseChartProps {
  /**
   * Bar orientation
   * @default "vertical"
   */
  orientation?: 'vertical' | 'horizontal'

  /**
   * Enable stacking
   * @default false
   */
  stack?: boolean

  /**
   * Relative bar size
   * @default "default"
   */
  barSize?: 'default' | 'large' | 'small'
}
```

### 4. Chat Components

```typescript
// src/components/chat/interface.ts

/**
 * Message type
 */
export interface Message {
  id: string
  role: 'user' | 'assistant' | 'system'
  content: string
  timestamp: Date
  metadata?: Record<string, any>
}

/**
 * Chat interface props
 */
export interface ChatInterfaceProps extends ComponentProps {
  /**
   * Messages array
   */
  messages: Message[]

  /**
   * Input value
   */
  input: string

  /**
   * Handle input change
   */
  onInputChange: (value: string) => void

  /**
   * Handle submit
   */
  onSubmit: (message: string) => void

  /**
   * Loading state
   */
  isLoading?: boolean

  /**
   * Placeholder text
   * @default "Type a message..."
   */
  placeholder?: string

  /**
   * Show thinking indicator
   * @default true
   */
  showThinking?: boolean

  /**
   * Enable voice input
   * @default false
   */
  voiceInput?: boolean

  /**
   * Enable file upload
   * @default false
   */
  fileUpload?: boolean

  /**
   * Max message length
   */
  maxLength?: number
}
```

---

## Dual API Types

### Supporting Both Props and Children

Every component type must support both APIs:

```typescript
/**
 * Type helper for dual API support
 */
export type DualAPIProps<PropsAPI, ChildrenAPI = {}> =
  | PropsAPI // Explicit props API
  | (Partial<PropsAPI> & ChildrenAPI & { children: React.ReactNode }) // MDX children API

// Example usage:
export type HeroSectionProps = DualAPIProps<
  {
    headline: string
    description: string
    primaryActionText: string
    primaryActionLink: string
    // ... other props
  },
  {
    // Additional props only for children API
    parseMarkdown?: boolean
  }
>
```

### Runtime Type Guards

```typescript
/**
 * Check if component is using props API
 */
export function isPropsAPI<T extends ComponentProps>(
  props: T
): props is T & { children?: never } {
  // If critical props are provided and no children, it's props API
  return 'headline' in props && !('children' in props && props.children)
}

/**
 * Check if component is using children API
 */
export function isChildrenAPI<T extends ComponentProps>(
  props: T
): props is T & { children: React.ReactNode } {
  return 'children' in props && !!props.children
}
```

---

## Variant Systems

### Variant Prop Types

Using Class Variance Authority (CVA) style:

```typescript
/**
 * Variant configuration
 */
export interface VariantConfig<T extends Record<string, any>> {
  /**
   * Variant options
   */
  variants: T

  /**
   * Default values
   */
  defaultVariants?: Partial<{
    [K in keyof T]: keyof T[K]
  }>

  /**
   * Compound variants (combinations)
   */
  compoundVariants?: Array<{
    [K in keyof T]?: keyof T[K]
  } & {
    className?: string
  }>
}

// Example: Button variants
export interface ButtonVariants {
  variant: {
    primary: string
    secondary: string
    outline: string
    ghost: string
  }
  size: {
    sm: string
    md: string
    lg: string
  }
  fullWidth: {
    true: string
    false: string
  }
}

export type ButtonVariantProps = {
  [K in keyof ButtonVariants]?: keyof ButtonVariants[K]
}

export type ButtonProps = ComponentProps<ButtonVariantProps>
```

---

## Theme Types

### Theme Configuration

```typescript
/**
 * Color palette
 */
export interface ColorPalette {
  50: string
  100: string
  200: string
  300: string
  400: string
  500: string
  600: string
  700: string
  800: string
  900: string
  950: string
}

/**
 * Theme colors
 */
export interface ThemeColors {
  primary: ColorPalette
  secondary: ColorPalette
  accent: ColorPalette
  neutral: ColorPalette
  success: ColorPalette
  warning: ColorPalette
  error: ColorPalette
  info: ColorPalette
}

/**
 * Typography configuration
 */
export interface Typography {
  fontFamily: {
    sans: string
    serif: string
    mono: string
  }
  fontSize: {
    xs: string
    sm: string
    base: string
    lg: string
    xl: string
    '2xl': string
    '3xl': string
    '4xl': string
    '5xl': string
    '6xl': string
  }
  fontWeight: {
    thin: number
    light: number
    normal: number
    medium: number
    semibold: number
    bold: number
    extrabold: number
  }
  lineHeight: {
    none: number
    tight: number
    snug: number
    normal: number
    relaxed: number
    loose: number
  }
}

/**
 * Spacing scale
 */
export interface Spacing {
  0: string
  px: string
  0.5: string
  1: string
  1.5: string
  2: string
  2.5: string
  3: string
  3.5: string
  4: string
  5: string
  6: string
  7: string
  8: string
  9: string
  10: string
  11: string
  12: string
  14: string
  16: string
  20: string
  24: string
  28: string
  32: string
  36: string
  40: string
  44: string
  48: string
  52: string
  56: string
  60: string
  64: string
  72: string
  80: string
  96: string
}

/**
 * Complete theme configuration
 */
export interface Theme {
  colors: ThemeColors
  typography: Typography
  spacing: Spacing
  borderRadius: Spacing
  shadows: Record<string, string>
  breakpoints: Record<string, string>
  mode: 'light' | 'dark'
}

/**
 * Theme provider props
 */
export interface ThemeProviderProps {
  theme?: Partial<Theme>
  defaultMode?: 'light' | 'dark'
  storageKey?: string
  children: React.ReactNode
}
```

---

## Implementation Details

### Package Export

```typescript
// src/index.ts

// Re-export all component types
export * from './components'

// Re-export theme types
export * from './theme'

// Re-export utility types
export * from './utils'

// Re-export shared types
export * from './shared'

// Named exports for convenience
export type {
  // Marketing
  HeroSectionProps,
  FeaturesSectionProps,
  PricingSectionProps,
  TestimonialsSectionProps,
  FAQSectionProps,
  CTASectionProps,
  TeamSectionProps,

  // Docs
  DocsPageProps,
  CodeBlockProps,
  CalloutProps,
  TabsProps,

  // Dashboard
  AreaChartProps,
  BarChartProps,
  LineChartProps,
  KPICardProps,
  DataTableProps,

  // Chat
  ChatInterfaceProps,
  Message,

  // Base
  ComponentProps,
  BaseComponentProps,
  MDXChildrenProps,

  // Theme
  Theme,
  ThemeColors,
  Typography
}
```

### TSConfig Setup

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "jsx": "react-jsx",
    "declaration": true,
    "declarationMap": true,
    "outDir": "dist",
    "rootDir": "src",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "types": ["react", "react-dom"]
  },
  "include": ["src"],
  "exclude": ["node_modules", "dist"]
}
```

---

## Type Testing

### Type-Level Tests

Use `tsd` for compile-time type checking:

```typescript
// types.test-d.ts
import { expectType, expectError } from 'tsd'
import type { HeroSectionProps } from '@mdxui/types'

// Correct usage
expectType<HeroSectionProps>({
  headline: 'Test',
  description: 'Test description',
  primaryActionText: 'Click me',
  primaryActionLink: '/test'
})

// Missing required prop should error
expectError<HeroSectionProps>({
  headline: 'Test'
  // Missing description, primaryActionText, primaryActionLink
})

// Wrong type should error
expectError<HeroSectionProps>({
  headline: 123, // Should be string
  description: 'Test',
  primaryActionText: 'Click',
  primaryActionLink: '/test'
})
```

---

## Documentation

### JSDoc Comments

All types must have comprehensive JSDoc:

```typescript
/**
 * Hero section component props
 *
 * The hero section is the attention-grabbing top section of a landing page.
 * It typically includes a headline, description, call-to-action buttons, and
 * optional media (image or video).
 *
 * @example
 * ```tsx
 * // Props API
 * <HeroSection
 *   headline="Transform Your Workflow"
 *   description="Build faster with AI"
 *   primaryActionText="Get Started"
 *   primaryActionLink="/signup"
 * />
 * ```
 *
 * @example
 * ```mdx
 * // MDX Children API
 * <HeroSection>
 * # Transform Your Workflow
 *
 * Build faster with AI
 *
 * [Get Started](/signup){.primary}
 * </HeroSection>
 * ```
 *
 * @see {@link https://mdxui.dev/docs/components/hero-section | Hero Section Documentation}
 */
export interface HeroSectionProps extends ComponentProps {
  // ...
}
```

---

## Version Management

### Semantic Versioning

- **Major:** Breaking type changes
- **Minor:** New optional props
- **Patch:** Doc updates, internal fixes

### Deprecation Strategy

```typescript
/**
 * @deprecated Use `headline` instead. Will be removed in v2.0.0
 */
export interface LegacyHeroProps {
  title: string // Old prop name
}

/**
 * Hero section props
 */
export interface HeroSectionProps extends ComponentProps {
  /**
   * Main headline
   * @formerly title (v1.x)
   */
  headline: string
}
```

---

**End of Specification**

This type system provides the **foundation** for all mdxui implementations, ensuring consistency, type safety, and great developer experience across the entire ecosystem.
