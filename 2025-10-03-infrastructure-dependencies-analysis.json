{
  "infrastructure_dependencies": [
    {
      "service": "Cloudflare Workers/Pages/D1/R2",
      "projects": [
        "app (Payload CMS)",
        "agent (AI code gen)",
        "workers/* (30+ microservices)",
        "data-ingestion",
        "docs"
      ],
      "status": "PRIMARY_INFRASTRUCTURE",
      "monthly_cost": "Pay-as-you-go (currently minimal)",
      "migration_effort": "N/A - Already on Cloudflare",
      "priority": "N/A - Already using"
    },
    {
      "service": "Neon PostgreSQL",
      "projects": ["workers/db (database RPC service)"],
      "status": "ACTIVE_DEPENDENCY",
      "monthly_cost": "Free tier or ~$19-69/month",
      "cloudflare_alternative": "D1 (SQLite) or Hyperdrive",
      "migration_effort": "7-14 days",
      "migration_path": "1. Schema conversion (PostgreSQL -> SQLite), 2. Data migration, 3. Query rewrites, 4. Testing",
      "priority": "medium",
      "notes": "Workers/db service uses Neon for PostgreSQL. Could migrate to D1 but would lose PostgreSQL-specific features. Hyperdrive could proxy to Neon with better performance."
    },
    {
      "service": "ClickHouse",
      "projects": ["workers/clickhouse_proxy", "data-ingestion (analytics)"],
      "status": "ACTIVE_DEPENDENCY",
      "monthly_cost": "Self-hosted or ClickHouse Cloud ($0.30/GB)",
      "cloudflare_alternative": "Workers Analytics Engine + R2",
      "migration_effort": "14-30 days",
      "migration_path": "1. Rewrite queries for Analytics Engine, 2. Export historical data to R2 Parquet, 3. Use R2 SQL for large queries",
      "priority": "low",
      "notes": "ClickHouse used for analytics/time-series data. Cloudflare Analytics Engine handles real-time, R2 SQL for historical."
    },
    {
      "service": "Vercel (Analytics/Speed Insights packages)",
      "projects": [
        "site/apps/careers.do",
        "site/apps/do.industries",
        "site/apps/gpt.do",
        "projects/services.delivery"
      ],
      "status": "NPM_PACKAGES_ONLY",
      "monthly_cost": "$0 (just client-side libraries)",
      "cloudflare_alternative": "Cloudflare Web Analytics (free)",
      "migration_effort": "1-2 days",
      "migration_path": "1. Remove @vercel/* packages, 2. Add Cloudflare Web Analytics beacon, 3. Update dashboards",
      "priority": "low",
      "notes": "Not hosting on Vercel, just using their npm packages for analytics. Easy to replace with Cloudflare alternatives."
    },
    {
      "service": "Google Cloud (Text-to-Speech)",
      "projects": ["workers/podcast", "workers/voice"],
      "status": "ACTIVE_DEPENDENCY",
      "monthly_cost": "~$4 per 1M characters",
      "cloudflare_alternative": "Workers AI (Whisper for STT, TTS coming)",
      "migration_effort": "3-7 days",
      "migration_path": "1. Test Workers AI TTS quality, 2. Rewrite API calls, 3. Update voice selection logic",
      "priority": "medium",
      "notes": "Google TTS used in voice/podcast workers. Workers AI may have TTS soon, or use ElevenLabs API."
    },
    {
      "service": "Docker/Containers",
      "projects": [
        "api.services/containers/nodejs",
        "api.services/terminal/container",
        "projects/services.delivery",
        "workers/build",
        "data-ingestion (for local dev)"
      ],
      "status": "DEVELOPMENT_ONLY",
      "monthly_cost": "$0 (local development)",
      "cloudflare_alternative": "Not needed for deployment",
      "migration_effort": "0 days",
      "migration_path": "N/A - Already deploying to Workers without containers",
      "priority": "N/A",
      "notes": "Docker used for local development and legacy testing. Production uses Cloudflare Workers directly."
    },
    {
      "service": "Legacy Vercel/Netlify Deployments",
      "projects": [
        "mdx/examples-archive/pitch (has vercel.json + netlify.toml)",
        "legacy/ai (has vercel.json)"
      ],
      "status": "ARCHIVED",
      "monthly_cost": "$0 (not deployed)",
      "cloudflare_alternative": "Cloudflare Pages",
      "migration_effort": "N/A",
      "migration_path": "Already archived, no migration needed",
      "priority": "N/A",
      "notes": "These are archived examples/legacy code. Not actively deployed."
    },
    {
      "service": "GitHub (Version Control + Actions)",
      "projects": ["All repositories"],
      "status": "ACTIVE_DEPENDENCY",
      "monthly_cost": "Free (public repos) or $4/user/month",
      "cloudflare_alternative": "None - GitHub is industry standard",
      "migration_effort": "N/A",
      "migration_path": "Not recommended",
      "priority": "N/A",
      "notes": "GitHub used for git hosting, CI/CD (Actions), issue tracking. Essential service, no migration needed."
    }
  ],
  "summary": {
    "total_services": 8,
    "critical_dependencies": [
      "Cloudflare (primary infrastructure)",
      "Neon PostgreSQL (database)",
      "GitHub (version control)"
    ],
    "migration_candidates": [
      {
        "service": "Neon PostgreSQL",
        "to": "Cloudflare Hyperdrive + D1",
        "effort": "7-14 days",
        "priority": "medium",
        "reasoning": "Reduce external dependencies, improve Workers co-location, leverage Hyperdrive connection pooling"
      },
      {
        "service": "ClickHouse",
        "to": "Workers Analytics Engine + R2 SQL",
        "effort": "14-30 days",
        "priority": "low",
        "reasoning": "Cloudflare-native analytics, reduce complexity, R2 SQL for ad-hoc queries"
      },
      {
        "service": "Vercel Analytics packages",
        "to": "Cloudflare Web Analytics",
        "effort": "1-2 days",
        "priority": "low",
        "reasoning": "Remove external dependencies, consolidate to Cloudflare stack"
      },
      {
        "service": "Google Cloud TTS",
        "to": "Workers AI or ElevenLabs",
        "effort": "3-7 days",
        "priority": "medium",
        "reasoning": "Reduce GCP dependency, potentially better quality/performance"
      }
    ],
    "estimated_monthly_savings": {
      "neon_to_d1": "$19-69/month -> $0-5/month (D1 free tier)",
      "clickhouse_to_workers": "$30-200/month -> $0-10/month (Analytics Engine free tier)",
      "vercel_analytics": "$0 (already free packages)",
      "google_tts": "~$4-40/month -> varies by alternative",
      "total_potential_savings": "$50-300/month"
    },
    "non_cloudflare_services": {
      "databases": ["Neon PostgreSQL", "ClickHouse"],
      "apis": ["Google Cloud TTS"],
      "npm_packages": ["@vercel/analytics", "@vercel/speed-insights"],
      "development_tools": ["Docker (local only)"]
    },
    "cloudflare_coverage": "~95% of production infrastructure",
    "architecture_status": "Heavily Cloudflare-centric with 2 database dependencies",
    "recommendation": "Strong Cloudflare alignment. Consider migrating Neon to Hyperdrive+D1 for full Cloudflare stack. ClickHouse and GCP TTS are lower priority."
  },
  "detailed_architecture": {
    "current_state": {
      "compute": "Cloudflare Workers (30+ services, 100% coverage)",
      "storage": {
        "object_storage": "Cloudflare R2 (primary)",
        "databases": {
          "sqlite": "Cloudflare D1 (app, agent, others)",
          "postgresql": "Neon (workers/db service)",
          "analytics": "ClickHouse (data-ingestion, workers/clickhouse_proxy)"
        },
        "kv_cache": "Cloudflare KV (multiple workers)"
      },
      "networking": {
        "cdn": "Cloudflare CDN",
        "dns": "Cloudflare DNS",
        "load_balancing": "Cloudflare Load Balancer"
      },
      "frontends": {
        "cms": "app/ - Payload CMS on Cloudflare Pages (OpenNext)",
        "sites": "site/* - Next.js on Cloudflare Pages",
        "docs": "docs/ - Fumadocs on Cloudflare Pages",
        "agent": "agent/ - React on Cloudflare Workers"
      },
      "apis": {
        "gateway": "workers/gateway (API routing)",
        "rpc": "workers/db, workers/auth, workers/ai, etc. (30+ services)",
        "webhooks": "workers/webhooks (GitHub, Stripe, WorkOS, Resend)"
      },
      "ai_ml": {
        "workers_ai": "Used in workers/ai, workers/generate, workers/embeddings",
        "openai": "Used in agent/, workers/ai",
        "google_tts": "Used in workers/voice, workers/podcast"
      },
      "monitoring": {
        "logs": "Cloudflare Logs",
        "analytics": "Cloudflare Analytics + ClickHouse",
        "errors": "Sentry (in agent/)"
      }
    },
    "migration_roadmap": {
      "phase_1_quick_wins": {
        "duration": "1-2 weeks",
        "tasks": [
          "Replace @vercel/analytics with Cloudflare Web Analytics",
          "Add Cloudflare Analytics Engine to more workers",
          "Consolidate monitoring to Cloudflare Logs"
        ],
        "impact": "Low effort, reduces external dependencies"
      },
      "phase_2_database_optimization": {
        "duration": "2-4 weeks",
        "tasks": [
          "Set up Cloudflare Hyperdrive for Neon PostgreSQL",
          "Test connection pooling and latency improvements",
          "Evaluate D1 for read-heavy queries",
          "Consider hybrid: Hyperdrive for writes, D1 replicas for reads"
        ],
        "impact": "Improved performance, reduced latency, maintained PostgreSQL compatibility"
      },
      "phase_3_analytics_modernization": {
        "duration": "3-6 weeks",
        "tasks": [
          "Migrate real-time analytics to Workers Analytics Engine",
          "Export ClickHouse historical data to R2 as Parquet",
          "Use R2 SQL (preview) for ad-hoc queries on historical data",
          "Build dashboards on Cloudflare Workers + D1"
        ],
        "impact": "Fully Cloudflare-native analytics, reduced costs"
      },
      "phase_4_ai_consolidation": {
        "duration": "1-2 weeks",
        "tasks": [
          "Evaluate Workers AI TTS quality vs Google Cloud TTS",
          "If acceptable, migrate voice/podcast workers",
          "Otherwise, consider ElevenLabs API for better quality"
        ],
        "impact": "Reduced GCP dependency, potentially better quality"
      }
    },
    "future_state_vision": {
      "goal": "100% Cloudflare-native infrastructure",
      "exceptions": [
        "GitHub (version control - industry standard)",
        "Sentry (error tracking - optional, could use Cloudflare Logs)",
        "OpenAI API (AI models - Workers AI doesn't cover all use cases yet)"
      ],
      "benefits": [
        "Single vendor for 95%+ of infrastructure",
        "Simplified billing and cost tracking",
        "Better co-location and lower latency",
        "Unified monitoring and observability",
        "Reduced context switching for developers"
      ],
      "estimated_monthly_cost": {
        "workers": "$5-25/month (Workers Paid plan)",
        "d1": "$0-10/month (mostly free tier)",
        "r2": "$10-50/month (storage + requests)",
        "pages": "$0-20/month (mostly free tier)",
        "analytics_engine": "$0-10/month (mostly free tier)",
        "hyperdrive": "$5/month (if used)",
        "github": "$0-4/user/month",
        "sentry": "$0-26/month (optional)",
        "openai": "Variable ($10-100+/month)",
        "total": "$30-250/month for full platform"
      }
    }
  },
  "analysis_metadata": {
    "generated_at": "2025-10-03T00:00:00Z",
    "analyzed_by": "Claude Code (Sonnet 4.5)",
    "repositories_scanned": 30,
    "config_files_analyzed": [
      "wrangler.toml",
      "wrangler.jsonc",
      "vercel.json",
      "netlify.toml",
      "Dockerfile",
      "docker-compose.yml",
      "package.json"
    ],
    "search_patterns": [
      "vercel|netlify|aws|gcp|google.cloud|azure|heroku|railway|render",
      "neon|postgres|postgresql",
      "clickhouse",
      "R2_|BUCKET|S3_",
      "D1_|DATABASE_URL"
    ]
  }
}
